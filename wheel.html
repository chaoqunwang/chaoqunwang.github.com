<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>幸运大转盘</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<style>
html{
    height:100%;
    overflow: hidden;
}
body{
    margin:0;
    height:100%;
    overflow: auto;
    visibility: hidden;
    font-size: .7rem;
}
ul{
    list-style: none;
    padding:0;
}
#wheel-wrap{
    max-width:24rem;
    margin:0 auto;
    text-align: center;
}
#w-tit{
    color:#fff;
    font-size: 1rem;
    margin:.5rem 0
}
#w-main{
}
#rotate{
    position: relative;
    width:16rem;
    height:16rem;
    margin:0 auto;
    background: url("whimgs/wheelbg.gif") no-repeat 0 0 ;
    -webkit-background-size:100%;
    background-size:100%;
}
#rotatein{
    position: relative;
    top:1rem;
    left:1rem;
    border-radius: 50%;
    width:14rem;
    height:14rem;
    background:url("whimgs/bg.png");
    background-size: 100% 100%;
    box-shadow: 0 0 6px #000;
}
.prize{
    position: absolute;
    top:0;
    left:4.5rem;
    z-index:2;
    width:5rem;
    height:14rem;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    padding:1rem 0;
}
.prize:nth-of-type(1){
    transform: rotate(22.5deg);
    transform-origin:50% 50%;

    -ms-transform: rotate(22.5deg);         /* IE 9 */
    -ms-transform-origin:50% 50%;        /* IE 9 */

    -webkit-transform: rotate(22.5deg);    /* Safari 和 Chrome */
    -webkit-transform-origin:50% 50%;    /* Safari 和 Chrome */

    -moz-transform: rotate(22.5deg);        /* Firefox */
    -moz-transform-origin:50% 50%;        /* Firefox */

    -o-transform: rotate(22.5deg);        /* Opera */
    -o-transform-origin:50% 50%; /* Opera */
}
.prize:nth-of-type(2){
    transform: rotate(67.5deg);
    transform-origin:50% 50%;

    -ms-transform: rotate(67.5deg);         /* IE 9 */
    -ms-transform-origin:50% 50%;        /* IE 9 */

    -webkit-transform: rotate(67.5deg);    /* Safari 和 Chrome */
    -webkit-transform-origin:50% 50%;    /* Safari 和 Chrome */

    -moz-transform: rotate(67.5deg);        /* Firefox */
    -moz-transform-origin:50% 50%;        /* Firefox */

    -o-transform: rotate(67.5deg);        /* Opera */
    -o-transform-origin:50% 50%; /* Opera */
}
.prize:nth-of-type(3){
    transform: rotate(112.5deg);
    transform-origin:50% 50%;

    -ms-transform: rotate(112.5deg);         /* IE 9 */
    -ms-transform-origin:50% 50%;        /* IE 9 */

    -webkit-transform: rotate(112.5deg);    /* Safari 和 Chrome */
    -webkit-transform-origin:50% 50%;    /* Safari 和 Chrome */

    -moz-transform: rotate(112.5deg);        /* Firefox */
    -moz-transform-origin:50% 50%;        /* Firefox */

    -o-transform: rotate(112.5deg);        /* Opera */
    -o-transform-origin:50% 50%; /* Opera */
}
.prize:nth-of-type(4){
    transform: rotate(157.5deg);
    transform-origin:50% 50%;

    -ms-transform: rotate(157.5deg);         /* IE 9 */
    -ms-transform-origin:50% 50%;        /* IE 9 */

    -webkit-transform: rotate(157.5deg);    /* Safari 和 Chrome */
    -webkit-transform-origin:50% 50%;    /* Safari 和 Chrome */

    -moz-transform: rotate(157.5deg);        /* Firefox */
    -moz-transform-origin:50% 50%;        /* Firefox */

    -o-transform: rotate(157.5deg);        /* Opera */
    -o-transform-origin:50% 50%; /* Opera */
}
.prize:nth-of-type(5){
    transform: rotate(202.5deg);
    transform-origin:50% 50%;

    -ms-transform: rotate(202.5deg);         /* IE 9 */
    -ms-transform-origin:50% 50%;        /* IE 9 */

    -webkit-transform: rotate(202.5deg);    /* Safari 和 Chrome */
    -webkit-transform-origin:50% 50%;    /* Safari 和 Chrome */

    -moz-transform: rotate(202.5deg);        /* Firefox */
    -moz-transform-origin:50% 50%;        /* Firefox */

    -o-transform: rotate(202.5deg);        /* Opera */
    -o-transform-origin:50% 50%; /* Opera */
}
.prize:nth-of-type(6){
    transform: rotate(247.5deg);
    transform-origin:50% 50%;

    -ms-transform: rotate(247.5deg);         /* IE 9 */
    -ms-transform-origin:50% 50%;        /* IE 9 */

    -webkit-transform: rotate(247.5deg);    /* Safari 和 Chrome */
    -webkit-transform-origin:50% 50%;    /* Safari 和 Chrome */

    -moz-transform: rotate(247.5deg);        /* Firefox */
    -moz-transform-origin:50% 50%;        /* Firefox */

    -o-transform: rotate(247.5deg);        /* Opera */
    -o-transform-origin:50% 50%; /* Opera */
}
.prize:nth-of-type(7){
    transform: rotate(292.5deg);
    transform-origin:50% 50%;

    -ms-transform: rotate(292.5deg);         /* IE 9 */
    -ms-transform-origin:50% 50%;        /* IE 9 */

    -webkit-transform: rotate(292.5deg);    /* Safari 和 Chrome */
    -webkit-transform-origin:50% 50%;    /* Safari 和 Chrome */

    -moz-transform: rotate(292.5deg);        /* Firefox */
    -moz-transform-origin:50% 50%;        /* Firefox */

    -o-transform: rotate(292.5deg);        /* Opera */
    -o-transform-origin:50% 50%; /* Opera */
}
.prize:nth-of-type(8){
    transform: rotate(337.5deg);
    transform-origin:50% 50%;

    -ms-transform: rotate(337.5deg);         /* IE 9 */
    -ms-transform-origin:50% 50%;        /* IE 9 */

    -webkit-transform: rotate(337.5deg);    /* Safari 和 Chrome */
    -webkit-transform-origin:50% 50%;    /* Safari 和 Chrome */

    -moz-transform: rotate(337.5deg);        /* Firefox */
    -moz-transform-origin:50% 50%;        /* Firefox */

    -o-transform: rotate(337.5deg);        /* Opera */
    -o-transform-origin:50% 50%; /* Opera */
}

#pointer{
    position: absolute;
    top:50%;
    left:50%;
    z-index:3;
    -webkit-transform: translate(-50%,-50%);
    -moz-transform: translate(-50%,-50%);
    -ms-transform: translate(-50%,-50%);
    -o-transform: translate(-50%,-50%);
    transform: translate(-50%,-50%);
    width:3rem;
    height:3.9rem;
    background: url("whimgs/pointer.png") no-repeat 0 0;
    background-size: 100% 100%;
}
.tiemsbox{
    color:#eee;
    margin:2rem 0 .5rem 0;
    font-size: 1.1rem;
}
.times{

}
#rule{
    color:#eee;
    display: inline-block;
    line-height: 1.1rem;
    border-bottom:1px solid #eee;
}
#dialogbox{
    display: none;
}
#dialogbox.active{
    display: block;
}
.dialogmask{
    position: absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background-color: rgba(0,0,0,.2);
    z-index: 9;
}
.dialogcard{
    position: absolute;
    top:40%;
    left:50%;
    z-index:10;
    -webkit-transform: translate(-50%,-50%);
    -moz-transform: translate(-50%,-50%);
    -ms-transform: translate(-50%,-50%);
    -o-transform: translate(-50%,-50%);
    transform: translate(-50%,-50%);
    z-index:10;
    width:11rem;
    background-color: #fff;
    text-align: left;
    padding:1rem;
}
.dialogclose{
    text-align: right;
}
.dialogclose .closebtn{
    position: absolute;
    top:.5rem;
    right:.5rem;
    display: inline-block;
    width:1rem;
    height:1rem;
    background:url("whimgs/btn_close_layer.png") no-repeat 0 0 ;
    -webkit-background-size:100% 100%;
    background-size:100% 100%;
}
.dialogtit{
    font-size: 1.0rem;
    color:green;
    text-align: center;
}
#dialogbox .result , #dialogbox .card2 , #dialogbox .card3{
    display: none;
}
#dialogbox .result.active , #dialogbox .card2.active , #dialogbox .card3.active{
    display:block;
}
#dialogbox address{
    font-size: .6rem;
    color:#999;
    margin-top:4rem;
}

.button {
    background: #db34ac;
    width: 180px;
    padding: 4px 0;
    position: absolute;
    left: 50%;
    top: 65%;
    transform: translateX(-50%) translateY(-50%);
    border-radius: 3px;
}
.button p {
        font-family: 'Roboto';
        text-align: center;
        text-transform: uppercase;
        color: #FFF;
        user-select: none;
    }

.button :hover {
         cursor: pointer;
     }

.button :after {
         content: "";
         display: block;
         position: absolute;
         width: 100%;
         height: 10%;
         border-radius: 50%;
         background-color: darken(#f1c40f, 20%);
         opacity: 0.4;
         bottom: -30px;
     }
input {
    line-height: 20px; 
    width: 50px; 
    height: 20px; 
} 	 
input[type=button] {
    line-height: 30px; 
    width: 80px; 
    height: 30px; 
}
select{
    line-height: 20px;
    height: 23px;
    width: 60px;
} 
</style>

</head>
<body>
<div id="wheel-wrap">
    <div id="w-tit" style="color: #f10f0f">越努力，越幸运</div>
	<span>每科个数：<select id="randomCount"><option value="1">1</option><option value="2" selected>2</option><option value="3">3</option></select></span>
    <div id="w-main">
        <div id="rotate">
            <div id="pointer"></div>
            <div id="rotatein">
                <div class="awardCard1"></div>
                <div class="awardCard2"></div>
            </div>

        </div>
        <!-- <div class="button"><p>切换版面</p></div> -->
    </div>
    <div id="w-foot"></div>
    <div id="dialogbox">
        <div class="dialogmask"></div>
        <div class="dialogcard">
            <!-- <div class="dialogclose">
                <span class="closebtn"></span>
            </div> -->
            <div class="result">
			    <div class="dialogtit">
					恭喜获得<br>
					<span id="award" style="color:red"></span>
					<table id='tasksTable' align="center" style="font-size:0.9rem"></table>
				</div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    setSize();
    window.addEventListener("resize",setSize,false);
    function setSize(){
        var oHtml = document.getElementsByTagName("html")[0];
        var oBody = document.getElementsByTagName("body")[0];
        var oWidth = window.innerWidth < 480 ? window.innerWidth : 480;
        oHtml.style.fontSize =oWidth/18+"px";
        oBody.style.visibility = "visible";
    };
</script>
<script src="https://cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
<script src="javascripts/random.js" type="text/javascript"></script>
<script type="text/javascript">
    var prizes = new Map([
        ['1', '一等奖'],  ['2', '二等奖'],  ['3', '三等奖'],  ['4', '四等奖'],  ['5', '再来一次'],  ['6', '只差一点'],  ['7', '下次可能中'],  ['8', '谢谢惠顾']
    ]);
    var tasks1 = new Map([
        ['1','生字词/听默写'],['2','语文练习帮'],['3','语文阅读理解'],['4','军晶作文1讲'],['5','背诗词/课文/古文'],['6','名家文章学习'],['7','语文试卷'],['8','语文学霸1讲'],
   ]);
     var tasks2 = new Map([
	['9','数学口算'],['10','新加坡数学3页'],['11','神机妙算1讲'],['12','神机妙算1练'],['13','数学试卷'],['14','7星学霸1讲'],['15','数学学霸1讲']
   ]);
    var tasks3 = new Map([
	['16','大猫阅读1篇'],['17','KET 10页'],['18','读霸2篇'],['19','写霸2篇'],['20','英语学霸1讲'],['21','背作文公式1页'],['22','唱歌1首'],['23','读讲文章/作文/名著'],['24','一起学挑战x3']
   ]);
    let tasks = new Map([...tasks1, ...tasks2, ...tasks3]);

    var tasksNum=3; // 3科各选几个
    for (var key of prizes.keys()) {
        $(".awardCard1").append('<div class="prize prize_' + key + '" style="font-size: .9rem;"><strong>' + prizes.get(key) + '</strong></div>');
        $(".awardCard2").append('<div class="prize prize_' + key + '" style="font-size: .9rem;"><strong>' + prizes.get(key) + '</strong></div>');
    }

    $(function () {
        //确定概率
        function posibility(){
	    var mTwister = new MersenneTwister();
            var random = Math.round(mTwister.random() * 199)+1;
            if(random <= 2){ //  2/200概率
                return 1;
            }else if( 2 < random && random <= 6 ){ // 4/200概率
                return 2;
            }else if( 6 < random && random <= 14 ){ // 8/200概率
                return 3;
            }else if( 14 < random && random <= 30 ){ // 16/200概率
                return 4;
            }else if( 30 < random && random <= 60 ){ // 30/200概率
                return 5;
            }else if( 60 < random && random <= 100 ){ // 40/200概率
                return 6;
            }else if( 100 < random && random <= 150 ){ // 50/200概率
                return 7;
        }else{ // 50/200概率
                return 8;
            }
        };

        //转盘逻辑
        var initrotate = 0;
        function handlebar() {
	    $('#pointer').css("pointer-events","none");
	    var p = posibility() ;
            var rotate = 360*3 + initrotate - initrotate%360 + (17 - 2*p) *22.5;
            $("#rotatein").css({
                "-webkit-transition": "all 2s ease-out",
                "-ms-transition": "all 2s ease-out",
                "transition":" all 2s ease-out",
                "-webkit-transform": "rotate("+ rotate +"deg)",
                "-moz-transform": "rotate("+ rotate +"deg)",
                "-ms-transform": "rotate("+ rotate +"deg)",
                "-o-transform": "rotate("+ rotate +"deg)",
                "transform":"rotate("+ rotate +"deg)"
            });
        initrotate = rotate;
	var rawartText = prizes.get(''+p);
        setTimeout(function () {
		dialoginfo(rawartText);
		$('#pointer').css("pointer-events","");
		},2100)
        };

        //点击
        var oDialog = $("#dialogbox");
        $("#pointer").click(function () {
           tasksNum = parseInt($('#randomCount').val()) ;
            handlebar();
        });

        //dialog
        function dialoginfo(rawartText){
		var mTwister = new MersenneTwister();
		var result = new Array();
		while(result.length < tasksNum){
			var e = Math.round(mTwister.random() * (tasks1.size-1))+1;
			if(result.indexOf(e) < 0){
			    result.push(e);
			}
		}
		while(result.length < 2*tasksNum){
			var e = Math.round(mTwister.random() * (tasks2.size-1))+tasks1.size+1;
			if(result.indexOf(e) < 0){
			    result.push(e);
			}
		}
		while(result.length < 3*tasksNum){
			var e = Math.round(mTwister.random() * (tasks3.size-1))+tasks1.size+tasks2.size+1;
			if(result.indexOf(e) < 0){
			    result.push(e);
			}
		}
            shuffle(result); // 打乱顺序

            $(oDialog).find(".result").addClass("active");
            $(oDialog).find("#award").text("--【"+ rawartText +"】--" + "\n");

		$("#tasksTable").html('');
		for(var i=0;i<result.length;i++){
		    $("#tasksTable").append('<tr><td align="left">' + result[i] + '</td><td align="right">' + tasks.get(''+result[i]) + '</td><td></tr>');
		}

            $(oDialog).addClass("active");
        };

	function shuffle(array) {
	  let curIndex = array.length;
	  let rdmIndex;
	  // 从数组末尾开始，逐个交换元素位置
	  while (curIndex !== 0) {
		// 随机选取一个元素
		rdmIndex = Math.floor(Math.random() * curIndex);
		curIndex--;
		// 交换元素位置
		[array[curIndex], array[rdmIndex]] = [array[rdmIndex], array[curIndex]];
	  }
	  return array;
	}

    });
</script>
</body>
</html>
