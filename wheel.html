<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>幸运大转盘</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<style>
html{
    height:100%;
    overflow: hidden;
}
body{
    margin:0;
    height:100%;
    overflow: auto;
    visibility: hidden;
    font-size: .7rem;
}
#wheel-wrap{
    max-width:24rem;
    margin:0 auto;
    text-align: center;
}
#w-tit{
    color:#fff;
    font-size: 1rem;
    margin:.5rem 0
}
#w-main{
}
#rotate{
    position: relative;
    width:16rem;
    height:16rem;
    margin:0 auto;
    background: url("whimgs/wheelbg.gif") no-repeat 0 0 ;
    -webkit-background-size:100%;
    background-size:100%;
}
#rotatein{
    position: relative;
    top:1rem;
    left:1rem;
    border-radius: 50%;
    width:14rem;
    height:14rem;
    background:url("whimgs/bg.png");
    background-size: 100% 100%;
    box-shadow: 0 0 6px #000;
}
.prize{
    position: absolute;
    top:0;
    left:4.5rem;
    z-index:2;
    width:5rem;
    height:14rem;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    padding:1rem 0;
}
.prize:nth-of-type(1){
    transform: rotate(22.5deg);
    transform-origin:50% 50%;
    -ms-transform: rotate(22.5deg);         /* IE 9 */
    -ms-transform-origin:50% 50%;        /* IE 9 */
    -webkit-transform: rotate(22.5deg);    /* Safari 和 Chrome */
    -webkit-transform-origin:50% 50%;    /* Safari 和 Chrome */
    -moz-transform: rotate(22.5deg);        /* Firefox */
    -moz-transform-origin:50% 50%;        /* Firefox */
    -o-transform: rotate(22.5deg);        /* Opera */
    -o-transform-origin:50% 50%; /* Opera */
}
.prize:nth-of-type(2){
    transform: rotate(67.5deg);
    transform-origin:50% 50%;
    -ms-transform: rotate(67.5deg);         /* IE 9 */
    -ms-transform-origin:50% 50%;        /* IE 9 */
    -webkit-transform: rotate(67.5deg);    /* Safari 和 Chrome */
    -webkit-transform-origin:50% 50%;    /* Safari 和 Chrome */
    -moz-transform: rotate(67.5deg);        /* Firefox */
    -moz-transform-origin:50% 50%;        /* Firefox */
    -o-transform: rotate(67.5deg);        /* Opera */
    -o-transform-origin:50% 50%; /* Opera */
}
.prize:nth-of-type(3){
    transform: rotate(112.5deg);
    transform-origin:50% 50%;
    -ms-transform: rotate(112.5deg);         /* IE 9 */
    -ms-transform-origin:50% 50%;        /* IE 9 */
    -webkit-transform: rotate(112.5deg);    /* Safari 和 Chrome */
    -webkit-transform-origin:50% 50%;    /* Safari 和 Chrome */
    -moz-transform: rotate(112.5deg);        /* Firefox */
    -moz-transform-origin:50% 50%;        /* Firefox */
    -o-transform: rotate(112.5deg);        /* Opera */
    -o-transform-origin:50% 50%; /* Opera */
}
.prize:nth-of-type(4){
    transform: rotate(157.5deg);
    transform-origin:50% 50%;
    -ms-transform: rotate(157.5deg);         /* IE 9 */
    -ms-transform-origin:50% 50%;        /* IE 9 */
    -webkit-transform: rotate(157.5deg);    /* Safari 和 Chrome */
    -webkit-transform-origin:50% 50%;    /* Safari 和 Chrome */
    -moz-transform: rotate(157.5deg);        /* Firefox */
    -moz-transform-origin:50% 50%;        /* Firefox */
    -o-transform: rotate(157.5deg);        /* Opera */
    -o-transform-origin:50% 50%; /* Opera */
}
.prize:nth-of-type(5){
    transform: rotate(202.5deg);
    transform-origin:50% 50%;
    -ms-transform: rotate(202.5deg);         /* IE 9 */
    -ms-transform-origin:50% 50%;        /* IE 9 */
    -webkit-transform: rotate(202.5deg);    /* Safari 和 Chrome */
    -webkit-transform-origin:50% 50%;    /* Safari 和 Chrome */
    -moz-transform: rotate(202.5deg);        /* Firefox */
    -moz-transform-origin:50% 50%;        /* Firefox */
    -o-transform: rotate(202.5deg);        /* Opera */
    -o-transform-origin:50% 50%; /* Opera */
}
.prize:nth-of-type(6){
    transform: rotate(247.5deg);
    transform-origin:50% 50%;
    -ms-transform: rotate(247.5deg);         /* IE 9 */
    -ms-transform-origin:50% 50%;        /* IE 9 */
    -webkit-transform: rotate(247.5deg);    /* Safari 和 Chrome */
    -webkit-transform-origin:50% 50%;    /* Safari 和 Chrome */
    -moz-transform: rotate(247.5deg);        /* Firefox */
    -moz-transform-origin:50% 50%;        /* Firefox */
    -o-transform: rotate(247.5deg);        /* Opera */
    -o-transform-origin:50% 50%; /* Opera */
}
.prize:nth-of-type(7){
    transform: rotate(292.5deg);
    transform-origin:50% 50%;
    -ms-transform: rotate(292.5deg);         /* IE 9 */
    -ms-transform-origin:50% 50%;        /* IE 9 */
    -webkit-transform: rotate(292.5deg);    /* Safari 和 Chrome */
    -webkit-transform-origin:50% 50%;    /* Safari 和 Chrome */
    -moz-transform: rotate(292.5deg);        /* Firefox */
    -moz-transform-origin:50% 50%;        /* Firefox */
    -o-transform: rotate(292.5deg);        /* Opera */
    -o-transform-origin:50% 50%; /* Opera */
}
.prize:nth-of-type(8){
    transform: rotate(337.5deg);
    transform-origin:50% 50%;
    -ms-transform: rotate(337.5deg);         /* IE 9 */
    -ms-transform-origin:50% 50%;        /* IE 9 */
    -webkit-transform: rotate(337.5deg);    /* Safari 和 Chrome */
    -webkit-transform-origin:50% 50%;    /* Safari 和 Chrome */
    -moz-transform: rotate(337.5deg);        /* Firefox */
    -moz-transform-origin:50% 50%;        /* Firefox */
    -o-transform: rotate(337.5deg);        /* Opera */
    -o-transform-origin:50% 50%; /* Opera */
}

#pointer{
    position: absolute;
    top:50%;
    left:50%;
    z-index:3;
    -webkit-transform: translate(-50%,-50%);
    -moz-transform: translate(-50%,-50%);
    -ms-transform: translate(-50%,-50%);
    -o-transform: translate(-50%,-50%);
    transform: translate(-50%,-50%);
    width:3rem;
    height:3.85rem;
    background: url("whimgs/pointer.png") no-repeat 0 0;
    background-size: 100% 100%;
}
#dialogbox{
    display: none;
}
#dialogbox.active{
    display: block;
}
.dialogmask{
    position: absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background-color: rgba(0,0,0,.2);
    z-index: 9;
}
.dialogcard{
    position: absolute;
    top:40%;
    left:50%;
    z-index:10;
    -webkit-transform: translate(-50%,-50%);
    -moz-transform: translate(-50%,-50%);
    -ms-transform: translate(-50%,-50%);
    -o-transform: translate(-50%,-50%);
    transform: translate(-50%,-50%);
    z-index:10;
    width:11rem;
    background-color: #fff;
    text-align: left;
    padding:1rem;
}
.dialogclose{
    text-align: right;
}
.dialogclose .closebtn{
    position: absolute;
    top:.5rem;
    right:.5rem;
    display: inline-block;
    width:1rem;
    height:1rem;
    background:url("whimgs/btn_close_layer.png") no-repeat 0 0 ;
    -webkit-background-size:100% 100%;
    background-size:100% 100%;
}
.dialogtit{
    font-size: 1.0rem;
    color:green;
    text-align: center;
}
#dialogbox .result , #dialogbox .card2 , #dialogbox .card3{
    display: none;
}
#dialogbox .result.active , #dialogbox .card2.active , #dialogbox .card3.active{
    display:block;
}
select{
    line-height: 20px;
    height: 23px;
    width: 36px;
} 
</style>

</head>
<body>
<div id="wheel-wrap">
    <div id="w-tit" style="color: #f10f0f">越努力，越幸运</div>
	<span>抽<select id="randomCount"><option value="3" selected>3</option><option value="6" >6</option><option value="9" >9</option></select>个</span>
    <div id="w-main">
        <div id="rotate">
            <div id="pointer"></div>
            <div id="rotatein">
                <div class="awardCard"></div>
            </div>
        </div>
        <!-- <div class="button"><p>切换版面</p></div> -->
    </div>
    <div id="w-foot"></div>
    <div id="dialogbox">
        <div class="dialogmask"></div>
        <div class="dialogcard">
            <!-- <div class="dialogclose">
                <span class="closebtn"></span>
            </div> -->
            <div class="result">
                <div class="dialogtit">
                    恭喜获得<br>
                    <span id="award" style="color:red"></span>
                    <table id='tasksTable' align="center" style="font-size:0.9rem"></table>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    setSize();
    window.addEventListener("resize",setSize,false);
    function setSize(){
        var oHtml = document.getElementsByTagName("html")[0];
        var oBody = document.getElementsByTagName("body")[0];
        var oWidth = window.innerWidth < 480 ? window.innerWidth : 480;
        oHtml.style.fontSize =oWidth/18+"px";
        oBody.style.visibility = "visible";
    };
</script>
<script src="https://cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
<script src="javascripts/random.js" type="text/javascript"></script>
<script type="text/javascript">
    var poems = ['01 骆宾王《咏鹅》','02 汉乐府《江南》','03 李绅《悯农》','04 李白《古朗月行（节选）》','05 李峤《风》','06 孟浩然《春晓》','07 李白《赠汪伦》','08 李白《静夜思》','09 白居易《池上》','10 杨万里《小池》',
         '11 贾岛《寻隐者不遇》','12 北朝民歌《敕勒歌》','13 王之涣《登鹳雀楼》','14 李白《望庐山瀑布》','15 柳宗元《江雪》','16 王安石《梅花》','17 李白《夜宿山寺》','18 胡令能《小儿垂钓》','19 贺知章《咏柳》',
         '20 杨万里《晓出净慈寺送林子方》','21 白居易《赋得古原草送别》','22 杜甫《绝句》','23 高鼎《村居》','24 查慎行《舟夜书所见》','25 李白《早发白帝城》','26 李白《望天门山》','27 杜牧《山行》','28 刘禹锡《望洞庭》',
         '29 袁枚《所见》','30 苏轼《饮湖上初晴后雨》','31 苏轼《赠刘景文》','32 叶绍翁《夜书所见》','33 王昌龄《采莲曲》','34《司马光》','35 白居易《忆江南》','36 王安石《元日》','37 杜甫《绝句》',
         '38 王维《九月九日忆山东兄弟》','39 苏轼《惠崇春江晚景》','40 杜牧《清明》','41 韦应物《滁州西涧》','42 曾几《三衢道中》','43 白居易《大林寺桃花》','44《守株待兔》','45 王维《鹿柴》','46 王翰《凉州词》',
         '47 高适《别董大》','48 王昌龄《出塞》','49 苏轼《题西林壁》','50 刘禹锡《浪淘沙》','51 李清照《夏日绝句》','52 白居易《暮江吟》','53 李商隐《嫦娥》','54 卢钺《雪梅》','55《精卫填海》','56《王戎不取道旁李》',
         '57 杨万里《宿新市徐公店》','58 范成大《四时田园杂兴（其二）》','59 辛弃疾《清平乐·村居》','60 卢纶《塞下曲》','61 王冕《墨梅》','62 罗隐《蜂》','63 王昌龄《芙蓉楼送辛渐》','64 李白《独坐敬亭山》',
         '65 毛泽东《卜算子·咏梅》','66 李白《黄鹤楼送孟浩然之广陵》','67 张志和《渔歌子》','68 张继《枫桥夜泊》','69 林升《题临安邸》','70 陆游《示儿》','71 龚自珍《己亥杂诗》','72 朱熹《观书有感二首（其一）》',
         '73 朱熹《观书有感二首（其二）》','74 林杰《乞巧》','75 纳兰性德《长相思》','76 王维《山居秋暝》','77 孟郊《游子吟》','78 范成大《四时田园杂兴》','79 王维《送元二使安西》',
         '80 翁卷《乡村四月》','81 王之涣《凉州词》','82 陆游《秋夜将晓出篱门迎凉有感》','83 王昌龄《从军行》','84 雷震《村晚》','85 杨万里《稚子弄冰》','86 王维《鸟鸣涧》','87《自相矛盾》','88《杨氏之子》',
         '89 苏轼《六月二十七日望湖楼醉书》','90 朱熹《春日》','91 王安石《书胡阴先生壁》','92 杜牧《江南春》','93 贺知章《回乡偶书》','94 孟浩然《宿建德江》','95 孟浩然《过故人庄》','96 辛弃疾《西江月》',
         '97《伯牙鼓琴》','98 范仲淹《江上渔者》','99 于谦《石灰吟》','100 叶绍翁《游园不值》','101 郑燮《竹石》','102 王安石《泊船瓜洲》','103 杜甫《春夜喜雨》','104 汉乐府《长歌行》','105 杜甫《闻官军收河南河北》',
         '106 韩翃《寒食》','107 古诗十九首《迢迢牵牛星》','108 王建《十五夜望月》','109 李贺《马诗》','110 诗经·小雅《采薇》（节选）','111 王观《卜算子·送鲍浩然之浙东》','112 黄庭坚《清平乐》',
         '113 韩愈《早春呈水部张十八员外》','114 苏轼《浣溪沙》','115《学弈》','116《两小儿辩日》'];
    var prizes = new Map([
	['1', '一等奖'],  ['2', '二等奖'],  ['3', '三等奖'],  ['4', '四等奖'],  ['5', '再来一次'],  ['6', '只差一点'],  ['7', '下次可能中'],  ['8', '谢谢惠顾']
    ]);
    var tasks1 = new Map([
        ['1','生字词/听默写'],['2','语文练习帮'],['3','语文阅读理解'],['4','军晶作文1讲'],['5','背诗/词/文'],['6','名家文章学习'],['7','语文试卷'],['8','学霸笔记/语文1讲'],
   ]);
     var tasks2 = new Map([
	['9','数学口算'],['10','新加坡数学4页'],['11','神机妙算1讲'],['12','神机妙算1练'],['13','数学试卷'],['14','7星学霸1讲'],['15','学霸笔记/数学1讲']
   ]);
    var tasks3 = new Map([
	['16','大猫阅读1篇'],['17','英语KET 10页'],['18','英语读霸2篇'],['19','英语写霸2篇'],['20','学霸笔记/英语1讲'],['21','背作文公式1页'],['22','唱歌1首'],['23','阅读20分钟'],['24','学习视频20分钟'],['25','[一起学]挑战x3']
   ]);
    let tasks = new Map([...tasks1, ...tasks2, ...tasks3]);

    var tasksNum=6;
    for (var key of prizes.keys()) {
        $(".awardCard").append('<div class="prize prize_' + key + '" style="font-size: .8rem;"><strong>' + prizes.get(key) + '</strong></div>');
    }

    $(function () {
        //确定概率
        function posibility(){
	    var mTwister = new MersenneTwister();
            var random = Math.round(mTwister.random() * 199)+1;
            if(random <= 2){ //  2/200概率
                return 1;
            }else if( 2 < random && random <= 6 ){ // 4/200概率
                return 2;
            }else if( 6 < random && random <= 14 ){ // 8/200概率
                return 3;
            }else if( 14 < random && random <= 30 ){ // 16/200概率
                return 4;
            }else if( 30 < random && random <= 60 ){ // 30/200概率
                return 5;
            }else if( 60 < random && random <= 100 ){ // 40/200概率
                return 6;
            }else if( 100 < random && random <= 150 ){ // 50/200概率
                return 7;
        }else{ // 50/200概率
                return 8;
            }
        };

        //转盘逻辑
        var initrotate = 0;
        function handlebar() {
	    $('#pointer').css("pointer-events","none");
	    var p = posibility() ;
            var rotate = 360*3 + initrotate - initrotate%360 + (17 - 2*p) *22.5;
            $("#rotatein").css({
                "-webkit-transition": "all 2s ease-out",
                "-ms-transition": "all 2s ease-out",
                "transition":" all 2s ease-out",
                "-webkit-transform": "rotate("+ rotate +"deg)",
                "-moz-transform": "rotate("+ rotate +"deg)",
                "-ms-transform": "rotate("+ rotate +"deg)",
                "-o-transform": "rotate("+ rotate +"deg)",
                "transform":"rotate("+ rotate +"deg)"
            });
        initrotate = rotate;
	var rawartText = prizes.get(''+p);
        setTimeout(function () {
        dialoginfo(rawartText);
        $('#pointer').css("pointer-events","");
        },2100)
        };

        //点击
        var oDialog = $("#dialogbox");
        $("#pointer").click(function () {
           tasksNum = parseInt($('#randomCount').val())  / 3;
           handlebar();
        });

        //dialog
        function dialoginfo(rawartText){
        var mTwister = new MersenneTwister();
        var poemResult = new Array();
        // poems select
        while(poemResult.length < 3){
            var e = Math.round(mTwister.random() * (poems.length-1))+1;
            var p = poems[e];
            if(poemResult.indexOf(p) < 0){
                poemResult.push(p);
            }
        }
        // task select
        var result = new Array();
        while(result.length < tasksNum){
            var e = Math.round(mTwister.random() * (tasks1.size-1))+1;
            if(result.indexOf(e) < 0){
                result.push(e);
            }
        }
        while(result.length < 2*tasksNum){
            var e = Math.round(mTwister.random() * (tasks2.size-1))+tasks1.size+1;
            if(result.indexOf(e) < 0){
                result.push(e);
            }
        }
        while(result.length < 3*tasksNum){
            var e = Math.round(mTwister.random() * (tasks3.size-1))+tasks1.size+tasks2.size+1;
            if(result.indexOf(e) < 0){
                result.push(e);
            }
        }

            $(oDialog).find(".result").addClass("active");
            $(oDialog).find("#award").text("--【"+ rawartText +"】--" + "\n");

        $("#tasksTable").html('');
        shuffle(result); // 打乱顺序
        for(var i=0;i<result.length;i++){
            $("#tasksTable").append('<tr><td align="left">' + result[i] + '</td><td align="right">' + tasks.get(''+result[i]) + '</td><td></tr>');
        }
        $("#tasksTable").append('<tr><td align="left" colspan="3">--背诗词--</td></tr>');
	shuffle(poemResult); // 打乱顺序
        for(var i=0;i<poemResult.length;i++){
            $("#tasksTable").append('<tr><td align="left" colspan="3">' + poemResult[i] + '</td></tr>');
        }
            $(oDialog).addClass("active");
        };

	function shuffle(array) {
	  let curIndex = array.length;
	  let rdmIndex;
	  // 从数组末尾开始，逐个交换元素位置
	  while (curIndex !== 0) {
        // 随机选取一个元素
        rdmIndex = Math.floor(Math.random() * curIndex);
        curIndex--;
        // 交换元素位置
        [array[curIndex], array[rdmIndex]] = [array[rdmIndex], array[curIndex]];
	  }
	  return array;
	}

    });
</script>
</body>
</html>
